#! /bin/bash

# Install Homebrew
BREW_INSTALLED=$(command -v brew) 
if ! [ -x $BREW_INSTALLED ]; then 
	echo Installing homebrew... 
	/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
	source ~/.bashrc
else
	echo Homebrew was already installed, continuing...
fi

# Install brewy thingies
echo -----------------
echo Installing apps...
brew update
cd ~/.dotfiles && brew bundle install --file=./Brewfile && brew bundle dump --global

# Setup ZSH as default shell
echo -----------------
if ! [[ $SHELL = *"zsh"* ]]; then
	echo Setting up zsh...
	chsh -s /usr/local/bin/zsh
else
	echo zsh is already the default shell
fi

echo Setting up oh-my-zsh...
sh -c "$(curl -fsSL https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"

# Install dotfiles
echo -----------------
echo Installing dotfiles...
rm ~/.zshrc
ln -s ~/.dotfiles/.zshrc ~/.zshrc

rm ~/.vimrc
ln -s ~/.dotfiles/.vimrc ~/.vimrc

# Create Code folder
echo -----------------
echo Creating Code folder
mkdir -p ~/Code

# Connect to git through ssh
cd ~/.dotfiles
echo -----------------
echo Fixing .dotfiles git remote...
git remote remove origin
git remote add origin git@github.com:jaimerodas/.dotfiles.git
git fetch origin
git branch --set-upstream-to=origin/master master
echo -----------------

cd ~/
